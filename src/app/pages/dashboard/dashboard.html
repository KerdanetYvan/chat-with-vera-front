<div class="pt-[62px] relative min-h-screen">
  @if (isDarkMode) {
    <img src="assets/bg_mobile_dark.jpg" alt="" role="background" class="fixed md:hidden lg:hidden inset-0 w-full h-full object-cover pointer-events-none select-none z-0" />
    <img src="assets/bg_desktop_dark.jpg" alt="" role="background" class="fixed hidden md:block lg:block inset-0 w-full h-full object-cover pointer-events-none select-none z-0" />
  } @else {
    <img src="assets/bg_mobile.png" alt="" role="background" class="fixed md:hidden lg:hidden inset-0 w-full h-full object-cover pointer-events-none select-none z-0" />
    <img src="assets/bg_desktop.png" alt="" role="background" class="fixed hidden md:block lg:block inset-0 w-full h-full object-cover pointer-events-none select-none z-0" />
  }

<<<<<<< HEAD
@if(overview) {
  <div>
    <div class="stats-cards">
      <div class="card">
        <h3>Utilisateurs</h3>
        <p>{{ overview.stats?.totalUsers ?? 0 }}</p>
      </div>
 
      <div class="card">
        <h3>R√©ponses</h3>
        <p>{{ overview.stats?.totalResponses ?? 0 }}</p>
=======
  <app-nav-bar class="fixed top-0 left-0 w-full z-50"></app-nav-bar>

  <main class="relative z-10 px-6 py-8 max-w-7xl mx-auto">
    <!-- Header avec statut de connexion -->
    <div class="mb-8">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-[38px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">Dashboard VERA</h1>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full {{ isConnected ? 'bg-green-500' : 'bg-red-500' }} animate-pulse"></div>
          <span class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">
            {{ isConnected ? 'Connect√©' : 'D√©connect√©' }}
          </span>
        </div>
>>>>>>> 9c8e872d8201bf0e49972d6732874019b29eef93
      </div>
    </div>

    <!-- Messages d'√©tat -->
    @if(loading) {
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 text-center">
        <p class="text-[18px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">Chargement...</p>
      </div>
    }

    @if(error) {
      <div class="bg-red-100 dark:bg-red-900/30 rounded-[20px] p-6 text-center mb-6">
        <p class="text-[18px] font-family-fustat text-red-800 dark:text-red-200">{{ error }}</p>
      </div>
    }

    <!-- Statistiques g√©n√©rales -->
    @if(overview) {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
          <h3 class="text-[18px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Utilisateurs</h3>
          <p class="text-[42px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ overview.stats?.totalUsers ?? 0 }}</p>
        </div>

        <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
          <h3 class="text-[18px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">R√©ponses totales</h3>
          <p class="text-[42px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ overview.stats?.totalResponses ?? 0 }}</p>
        </div>

        <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
          <h3 class="text-[18px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Probl√®mes signal√©s</h3>
          <p class="text-[42px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ getProblemStats().withProblems }}</p>
          <p class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">sur {{ responses.length }} r√©ponse(s)</p>
        </div>
      </div>
    }

    <!-- Distribution des r√©ponses -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- Gain de temps -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
        <h3 class="text-[20px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-4">‚è±Ô∏è Gain de temps</h3>
        <div class="space-y-3">
          @for(item of getWinTimeDistribution(); track item.text) {
            <div>
              <div class="flex justify-between items-center mb-1">
                <span class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ item.text }}</span>
                <span class="text-[14px] font-family-fustat font-medium text-[#111110] dark:text-[#DBF9BE]">{{ item.percentage }}%</span>
              </div>
              <div class="w-full bg-[#111110]/10 dark:bg-[#FEF2E4]/10 rounded-full h-2">
                <div class="bg-[#DBF9BE] h-2 rounded-full transition-all" [style.width.%]="item.percentage"></div>
              </div>
              <span class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ item.count }} r√©ponse(s)</span>
            </div>
          }
        </div>
      </div>

      <!-- Facilit√© d'utilisation -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
        <h3 class="text-[20px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-4">‚ú® Facilit√© d'utilisation</h3>
        <div class="space-y-3">
          @for(item of getVeraEasyDistribution(); track item.text) {
            <div>
              <div class="flex justify-between items-center mb-1">
                <span class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ item.text }}</span>
                <span class="text-[14px] font-family-fustat font-medium text-[#111110] dark:text-[#DBF9BE]">{{ item.percentage }}%</span>
              </div>
              <div class="w-full bg-[#111110]/10 dark:bg-[#FEF2E4]/10 rounded-full h-2">
                <div class="bg-[#DBF9BE] h-2 rounded-full transition-all" [style.width.%]="item.percentage"></div>
              </div>
              <span class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ item.count }} r√©ponse(s)</span>
            </div>
          }
        </div>
      </div>

      <!-- Fiabilit√© -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
        <h3 class="text-[20px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-4">üéØ Fiabilit√©</h3>
        <div class="space-y-3">
          @for(item of getFiabilityDistribution(); track item.text) {
            <div>
              <div class="flex justify-between items-center mb-1">
                <span class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ item.text }}</span>
                <span class="text-[14px] font-family-fustat font-medium text-[#111110] dark:text-[#DBF9BE]">{{ item.percentage }}%</span>
              </div>
              <div class="w-full bg-[#111110]/10 dark:bg-[#FEF2E4]/10 rounded-full h-2">
                <div class="bg-[#DBF9BE] h-2 rounded-full transition-all" [style.width.%]="item.percentage"></div>
              </div>
              <span class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ item.count }} r√©ponse(s)</span>
            </div>
          }
        </div>
      </div>

      <!-- Recommandation -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-6 shadow-lg">
        <h3 class="text-[20px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-4">üëç Recommandation</h3>
        <div class="space-y-3">
          @for(item of getRecommandationDistribution(); track item.text) {
            <div>
              <div class="flex justify-between items-center mb-1">
                <span class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ item.text }}</span>
                <span class="text-[14px] font-family-fustat font-medium text-[#111110] dark:text-[#DBF9BE]">{{ item.percentage }}%</span>
              </div>
              <div class="w-full bg-[#111110]/10 dark:bg-[#FEF2E4]/10 rounded-full h-2">
                <div class="bg-[#DBF9BE] h-2 rounded-full transition-all" [style.width.%]="item.percentage"></div>
              </div>
              <span class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ item.count }} r√©ponse(s)</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Moyennes globales (gard√©es pour r√©f√©rence num√©rique) -->
    @if(getGlobalAverages()) {
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-8 shadow-lg mb-8">
        <h2 class="text-[28px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-6">R√©sum√© global</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div class="text-center">
            <div class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Facilit√© d'utilisation</div>
            <div class="text-[32px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ getGlobalAverages()!.veraEasy }}/5</div>
          </div>
          <div class="text-center">
            <div class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Gain de temps</div>
            @if(getWinTimeDistribution()[0]) {
              <div class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ getWinTimeDistribution()[0].percentage }}%</div>
              <div class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mt-1">{{ getWinTimeDistribution()[0].text }}</div>
            }
          </div>
          <div class="text-center">
            <div class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Fiabilit√©</div>
            @if(getFiabilityDistribution()[0]) {
              <div class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ getFiabilityDistribution()[0].percentage }}%</div>
              <div class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mt-1">{{ getFiabilityDistribution()[0].text }}</div>
            }
          </div>
          <div class="text-center">
            <div class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-2">Recommandation</div>
            @if(getRecommandationDistribution()[0]) {
              <div class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">{{ getRecommandationDistribution()[0].percentage }}%</div>
              <div class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60 mt-1">{{ getRecommandationDistribution()[0].text }}</div>
            }
          </div>
        </div>
      </div>
    }

    <!-- Statistiques par cat√©gorie -->
    @if(getStatsByCategory().length > 0) {
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-8 shadow-lg mb-8">
        <h2 class="text-[28px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-6">Classement par source</h2>
        <div class="overflow-x-auto">
          <table class="w-full text-[14px] font-family-fustat">
            <thead>
              <tr class="border-b border-[#111110]/10 dark:border-[#FEF2E4]/10">
                <th class="text-left py-3 px-4 text-[#111110]/60 dark:text-[#FEF2E4]/60">Source</th>
                <th class="text-center py-3 px-4 text-[#111110]/60 dark:text-[#FEF2E4]/60">R√©ponses</th>
                <th class="text-center py-3 px-4 text-[#111110]/60 dark:text-[#FEF2E4]/60">Facilit√© (moy.)</th>
                <th class="text-center py-3 px-4 text-[#111110]/60 dark:text-[#FEF2E4]/60">Gain de temps</th>
                <th class="text-center py-3 px-4 text-[#111110]/60 dark:text-[#FEF2E4]/60">Fiabilit√©</th>
              </tr>
            </thead>
            <tbody>
              @for(cat of getStatsByCategory(); track cat.category) {
                <tr class="border-b border-[#111110]/5 dark:border-[#FEF2E4]/5 hover:bg-[#DBF9BE]/10 transition-colors">
                  <td class="py-3 px-4 font-medium text-[#111110] dark:text-[#FEF2E4]">{{ cat.category }}</td>
                  <td class="text-center py-3 px-4 text-[#111110] dark:text-[#FEF2E4]">{{ cat.count }}</td>
                  <td class="text-center py-3 px-4 text-[#111110] dark:text-[#FEF2E4]">{{ cat.avgVeraEasy }}/5</td>
                  <td class="text-center py-3 px-4 text-[#111110] dark:text-[#FEF2E4] text-[12px]">{{ cat.mostFrequentWinTime }}</td>
                  <td class="text-center py-3 px-4 text-[#111110] dark:text-[#FEF2E4] text-[12px]">{{ cat.mostFrequentFiability }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- Top et Bottom classements -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Top 5 r√©ponses -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-8 shadow-lg">
        <h2 class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-6">üèÜ Top 5 r√©ponses</h2>
        <div class="space-y-3">
          @for(response of getTopResponses(); track response.id; let i = $index) {
            <div class="flex items-center gap-4 p-4 bg-white dark:bg-[#111110] rounded-xl border-l-4 border-green-500">
              <div class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] w-8">{{ i + 1 }}</div>
              <div class="flex-1">
                <div class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ response.whereDoYouHeard }}</div>
                <div class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ formatDate(response.horodateur) }}</div>
              </div>
              <div class="text-[24px] font-family-lastik text-green-600 dark:text-green-400">{{ response.recommandation }}/10</div>
            </div>
          }
        </div>
      </div>

      <!-- Bottom 5 r√©ponses -->
      <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-8 shadow-lg">
        <h2 class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] mb-6">‚ö†Ô∏è Points d'attention</h2>
        <div class="space-y-3">
          @for(response of getBottomResponses(); track response.id; let i = $index) {
            <div class="flex items-center gap-4 p-4 bg-white dark:bg-[#111110] rounded-xl border-l-4 border-orange-500">
              <div class="text-[24px] font-family-lastik text-[#111110] dark:text-[#DBF9BE] w-8">{{ i + 1 }}</div>
              <div class="flex-1">
                <div class="text-[14px] font-family-fustat text-[#111110] dark:text-[#FEF2E4]">{{ response.whereDoYouHeard }}</div>
                <div class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60">{{ formatDate(response.horodateur) }}</div>
              </div>
              <div class="text-[24px] font-family-lastik text-orange-600 dark:text-orange-400">{{ response.recommandation }}/10</div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Section r√©ponses en temps r√©el -->
    <div class="bg-[#FEF2E4]/95 dark:bg-[#1F1C19]/95 rounded-[20px] p-8 shadow-lg">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-[28px] font-family-lastik text-[#111110] dark:text-[#DBF9BE]">R√©ponses en temps r√©el</h2>
        <span class="text-[14px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">
          {{ responses.length }} r√©ponse(s)
        </span>
      </div>

      @if(responses.length === 0) {
        <div class="text-center py-12">
          <p class="text-[18px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">
            En attente de nouvelles r√©ponses...
          </p>
        </div>
      } @else {
        <div class="space-y-4 max-h-[600px] overflow-y-auto">
          @for(response of responses; track response.id) {
            <div class="bg-white dark:bg-[#111110] rounded-xl p-6 shadow-md border-l-4 border-[#DBF9BE] hover:shadow-lg transition-shadow">
              <!-- Header de la carte -->
              <div class="flex items-start justify-between mb-4">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="inline-block px-3 py-1 bg-[#DBF9BE]/30 dark:bg-[#DBF9BE]/20 text-[#111110] dark:text-[#DBF9BE] rounded-full text-[12px] font-family-fustat font-medium">
                      {{ response.whereDoYouHeard }}
                    </span>
                  </div>
                  <p class="text-[12px] font-family-fustat text-[#111110]/60 dark:text-[#FEF2E4]/60">
                    {{ formatDate(response.horodateur) }}
                  </p>
                </div>
              </div>

              <!-- Pourquoi VERA -->
              @if(response.pourquoiVera) {
                <div class="mb-4 pb-4 border-b border-[#111110]/10 dark:border-[#FEF2E4]/10">
                  <p class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-1">Pourquoi VERA :</p>
                  <p class="text-[14px] text-[#111110] dark:text-[#FEF2E4]">{{ response.pourquoiVera }}</p>
                </div>
              }

              <!-- Contenu de la r√©ponse -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-[14px] font-family-fustat mb-4">
                <div>
                  <span class="text-[#111110]/60 dark:text-[#FEF2E4]/60">Facilit√© :</span>
                  <span class="ml-2 text-[#111110] dark:text-[#FEF2E4] font-medium">{{ getCleanText(response.veraEasy) }}</span>
                </div>
                <div>
                  <span class="text-[#111110]/60 dark:text-[#FEF2E4]/60">Gain de temps :</span>
                  <span class="ml-2 text-[#111110] dark:text-[#FEF2E4] font-medium">{{ getCleanText(response.winTime) }}</span>
                </div>
                <div>
                  <span class="text-[#111110]/60 dark:text-[#FEF2E4]/60">Fiabilit√© :</span>
                  <span class="ml-2 text-[#111110] dark:text-[#FEF2E4] font-medium">{{ getCleanText(response.fiability) }}</span>
                </div>
                <div>
                  <span class="text-[#111110]/60 dark:text-[#FEF2E4]/60">Recommandation :</span>
                  <span class="ml-2 text-[#111110] dark:text-[#FEF2E4] font-medium">{{ getCleanText(response.recommandation) }}</span>
                </div>
              </div>

              <!-- Statut du probl√®me -->
              <div class="mb-4">
                <span class="text-[#111110]/60 dark:text-[#FEF2E4]/60">Probl√®me rencontr√© :</span>
                <span class="ml-2 text-[#111110] dark:text-[#FEF2E4] font-medium">
                  {{ hasProblem(response) ? 'Oui' : 'Non' }}
                </span>
              </div>

              <!-- Plus appr√©ci√© -->
              @if(response.moreLiked) {
                <div class="mt-4 pt-4 border-t border-[#111110]/10 dark:border-[#FEF2E4]/10">
                  <p class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-1">Ce qui a √©t√© le plus appr√©ci√© :</p>
                  <p class="text-[14px] text-[#111110] dark:text-[#FEF2E4]">{{ response.moreLiked }}</p>
                </div>
              }

              <!-- Probl√®me rencontr√© -->
              @if(hasProblem(response) && response.ifProblem) {
                <div class="mt-4 pt-4 border-t border-[#111110]/10 dark:border-[#FEF2E4]/10">
                  <p class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-1">Probl√®me rencontr√© :</p>
                  <p class="text-[14px] text-[#111110] dark:text-[#FEF2E4]">{{ response.ifProblem }}</p>
                </div>
              }

              <!-- Suggestion -->
              @if(response.suggestion) {
                <div class="mt-4 pt-4 border-t border-[#111110]/10 dark:border-[#FEF2E4]/10">
                  <p class="text-[12px] text-[#111110]/60 dark:text-[#FEF2E4]/60 mb-1">Suggestion :</p>
                  <p class="text-[14px] text-[#111110] dark:text-[#FEF2E4]">{{ response.suggestion }}</p>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </main>
</div>
